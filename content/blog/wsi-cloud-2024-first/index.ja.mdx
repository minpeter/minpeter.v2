---
title: 2024å¹´åœ°æ–¹æŠ€èƒ½ç«¶æŠ€å¤§ä¼šã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç¬¬1èª²é¡Œ
description: AWS CloudFormationã‚’ä½¿ç”¨ã—ãŸå®Œå…¨è‡ªå‹•è¨­å®š
published: 2024-04-01
lang:
  - ja
machine_translated: true
---

> April Fool's Day ğŸ¤ª

å®Ÿéš›ã®æ–¹æ³•ã¯æ‰±ã„ã¾ã›ã‚“ã€‚ç‰¹å®šã®æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒGoogleæ¤œç´¢ã§ã©ã‚Œã ã‘æµå…¥ã™ã‚‹ã‹å®Ÿé¨“ã™ã‚‹ãŸã‚ã«ä½œæˆã—ã¾ã—ãŸã€‚

---

```yaml
AWSTemplateFormatVersion: 2010-09-09
Resources:
  # empty resource stack
  EmptyResource:
    Type: "AWS::CloudFormation::Stack"
    Properties:
      TemplateURL: "https://s3.amazonaws.com/my-bucket/empty-template.yaml"

  # only print message
  EchoResource:
    Type: "AWS::CloudFormation::CustomResource"
    Properties:
      ServiceToken: "arn:aws:lambda:::function:my-echo-function"
      Properties:
        Message: "Hello, world!"

Outputs:
  EmptyOutput:
    Value: ""
  EchoOutput:
    Value: !GetAtt EchoResource.Outputs.Message
```

## AWS CloudFormationã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### 1. ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ¦‚è¦

æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯AWS CloudFormationã‚’æ´»ç”¨ã—ã¦ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è‡ªå‹•è¨­å®šã—ã¾ã™ã€‚

- **ç©ºã®ãƒªã‚½ãƒ¼ã‚¹ã‚¹ã‚¿ãƒƒã‚¯ä½œæˆ**: `EmptyResource`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯`empty-template.yaml`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‚ç…§ã—ã¦ç©ºã®ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚å®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚¹ã‚¿ãƒƒã‚¯æ§‹é€ ã¨ä¾å­˜é–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ã®ã«æœ‰ç”¨ã§ã™ã€‚
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ›**: `EchoResource`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯Lambdaé–¢æ•°`my-echo-function`ã‚’å‘¼ã³å‡ºã—ã¦ã€ŒHello, world!ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚
- **å‡ºåŠ›å€¤ã®æä¾›**: `Outputs`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯`EmptyOutput`ï¼ˆç©ºæ–‡å­—åˆ—ï¼‰ãŠã‚ˆã³`EchoOutput`ï¼ˆLambdaé–¢æ•°å‡ºåŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ã®å€¤ã‚’æä¾›ã—ã¾ã™ã€‚

### 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ç”¨æ–¹æ³•

1. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜**:
   - `empty-template.yaml`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ãƒã‚±ãƒƒãƒˆã«ä¿å­˜ã—ã¾ã™ã€‚
   - æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»»æ„ã®å ´æ‰€ã«ä¿å­˜ã—ã¾ã™ã€‚
2. **CloudFormationã‚¹ã‚¿ãƒƒã‚¯ã®ä½œæˆ**:
   - AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¾ãŸã¯CLIã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦CloudFormationã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚
   - ã‚¹ã‚¿ãƒƒã‚¯ä½œæˆæ™‚ã«`my-echo-function` Lambdaé–¢æ•°ã®ARNã‚’`EchoResource`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®`ServiceToken`å±æ€§ã«å…¥åŠ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
3. **å‡ºåŠ›ã®ç¢ºèª**:
   - ã‚¹ã‚¿ãƒƒã‚¯ä½œæˆå®Œäº†å¾Œã€`Outputs`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®`EmptyOutput`ãŠã‚ˆã³`EchoOutput`ã®å€¤ã‚’ç¢ºèªã—ã¾ã™ã€‚

### 3. è¿½åŠ æ©Ÿèƒ½ã¨æ´»ç”¨

**3.1. ãƒªã‚½ãƒ¼ã‚¹ã®è¿½åŠ **:

æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯åŸºæœ¬çš„ãªä¾‹ã§ã‚ã‚Šã€å®Ÿéš›ã®ç’°å¢ƒã«åˆã‚ã›ã¦æ§˜ã€…ãªãƒªã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ ã—ã¦è‡ªå‹•è¨­å®šã‚’æ‹¡å¼µã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒªã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

- EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆã¨è¨­å®š
- RDSãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆã¨è¨­å®š
- S3ãƒã‚±ãƒƒãƒˆã®ä½œæˆã¨è¨­å®š
- CloudFrontãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®š
- Lambdaé–¢æ•°ã®ä½œæˆã¨è¨­å®š

**3.2. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨æ¡ä»¶ã®è¿½åŠ **:

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ã‚¹ã‚¿ãƒƒã‚¯ä½œæˆæ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å€¤ã‚’å—ã‘å–ã‚Šã€å‹•çš„ã«è¨­å®šã‚’å¤‰æ›´ã§ãã¾ã™ã€‚ã¾ãŸã€æ¡ä»¶æ–‡ã‚’æ´»ç”¨ã—ã¦ç’°å¢ƒã«å¿œã˜ã¦

è¨­å®šã‚’èª¿æ•´ã§ãã¾ã™ã€‚

## EKSä½œæˆå¾ŒALB ingressã§è¨­å®š

```yaml
apiVersion: "klodd.tjcsec.club/v1"
kind: Challenge
metadata:
name: test
spec:
name: Test Challenge
timeout: 10000
pods:
  - name: app
    ports:
      - port: 80
    spec:
      containers:
        - name: main
          image: traefik/whoami:latest
          resources:
            requests:
              memory: 100Mi
              cpu: 75m
            limits:
              memory: 250Mi
              cpu: 100m
      automountServiceAccountToken: false
expose:
  kind: http
  pod: app
  port: 80
middlewares:
  - contentType:
      autoDetect: false
  - rateLimit:
      average: 5
      burst: 10

```

`kubectl apply -f challenge.yaml`

```yaml
apiVersion: "klodd.tjcsec.club/v1"
kind: Challenge
metadata:
  name: analects
spec:
  name: Analects
  timeout: 300000
  pods:
    - name: app
      ports:
        - port: 80
      spec:
        containers:
          - name: app
            image: analects-app:latest
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
              limits:
                memory: 200Mi
                cpu: 100m
            startupProbe:
              httpGet:
                path: "/search.php?q=with%20two%20others"
                port: 80
              initialDelaySeconds: 0
              periodSeconds: 5
              failureThreshold: 30
        automountServiceAccountToken: false
    - name: mysql
      ports:
        - port: 3306
      spec:
        containers:
          - name: mysql
            image: analects-mysql:latest
            resources:
              requests:
                memory: 200Mi
                cpu: 50m
              limits:
                memory: 500Mi
                cpu: 100m
        automountServiceAccountToken: false
  expose:
    kind: http
    pod: app
    port: 80
```

ä¸Šè¨˜ã®yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€`kubectl apply -f challenge.yaml`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨è©²å½“ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

**3.3. ãƒ‡ãƒ—ãƒ­ã‚¤ã®è‡ªå‹•åŒ–**:

AWS CodePipelineã€CodeBuildãªã©ã‚’æ´»ç”¨ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ›´æ–°ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–ã§ãã¾ã™ã€‚

**3.4. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã¨å†åˆ©ç”¨**:

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ã¦ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã€æ§˜ã€…ãªç’°å¢ƒã«åˆã‚ã›ã¦ç°¡å˜ã«èª¿æ•´ã§ãã¾ã™ã€‚

### 4. å‚è€ƒè³‡æ–™

- AWS CloudFormationãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: [https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/)
- AWS CloudFormationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¾‹: [ç„¡åŠ¹ãªURLå‰Šé™¤æ¸ˆã¿]
- AWS Lambdaãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: [https://docs.aws.amazon.com/lambda/](https://docs.aws.amazon.com/lambda/)

### 5. æ³¨æ„äº‹é …

- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å‰ã«å†…å®¹ã‚’ååˆ†ã«æ¤œè¨ã—ã€å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£ãƒ»è£œå®Œã—ã¦ãã ã•ã„ã€‚
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã«ã‚ˆã‚Šç™ºç”Ÿã™ã‚‹è²»ç”¨ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è²¬ä»»ã§ã™ã€‚
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä¾‹ã§ã‚ã‚Šã€å®Ÿéš›ã®ç’°å¢ƒã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚

### 6. ãã®ä»–

æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æŠ€èƒ½ç«¶æŠ€å¤§ä¼šç¬¬1èª²é¡Œå®Œäº†ã®ãŸã‚ã®åŸºæœ¬çš„ãªæ çµ„ã¿ã‚’æä¾›ã—ã€å®Ÿéš›ã®ç’°å¢ƒã«åˆã‚ã›ã¦æ§˜ã€…ãªæ©Ÿèƒ½ã‚’è¿½åŠ ãƒ»æ‹¡å¼µã§ãã¾ã™ã€‚

##

æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæŠ€èƒ½ç«¶æŠ€å¤§ä¼šç¬¬1èª²é¡Œå®Œäº†ã®ãŠå½¹ã«ç«‹ã¦ã‚Œã°å¹¸ã„ã§ã™ã€‚
